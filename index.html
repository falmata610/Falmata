<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ZonMax - Amazon Style Store</title>
<style>
  /* Reset and base */
  * {
    box-sizing: border-box;
  }
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    background: #fff;
    color: #111;
  }
  a {
    text-decoration: none;
    color: inherit;
  }
  img {
    max-width: 100%;
    display: block;
  }
  button {
    cursor: pointer;
    border: none;
    background: none;
  }
  /* Header */
  header {
    background-color: #131921;
    color: white;
    padding: 10px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  #logo {
    font-size: 1.5rem;
    font-weight: bold;
    user-select: none;
  }
  #searchInput {
    width: 300px;
    max-width: 60vw;
    padding: 6px 12px;
    border-radius: 4px;
    border: none;
    outline: none;
    font-size: 1rem;
  }
  #cartBtn {
    position: relative;
    color: white;
    font-size: 1.3rem;
  }
  #cartCount {
    position: absolute;
    top: -6px;
    right: -10px;
    background: #f08804;
    border-radius: 50%;
    padding: 2px 6px;
    font-size: 0.75rem;
    font-weight: bold;
    color: black;
  }
  /* Hero carousel */
  #heroCarousel {
    position: relative;
    max-width: 1200px;
    margin: 20px auto;
    overflow: hidden;
    border-radius: 6px;
  }
  #heroImage {
    width: 100%;
    display: block;
    border-radius: 6px;
  }
  #prevHero, #nextHero {
    position: absolute;
    top: 50%;
    background: rgba(19,25,33,0.7);
    color: white;
    border-radius: 50%;
    width: 36px;
    height: 36px;
    font-size: 20px;
    line-height: 36px;
    text-align: center;
    transform: translateY(-50%);
    user-select: none;
    transition: background 0.3s;
  }
  #prevHero:hover, #nextHero:hover {
    background: #f08804;
    color: black;
  }
  #prevHero {
    left: 10px;
  }
  #nextHero {
    right: 10px;
  }
  /* Deals section */
  #dealsSection {
    max-width: 1200px;
    margin: 30px auto;
    padding: 0 15px;
  }
  #dealsSection h2 {
    margin-bottom: 15px;
  }
  #dealsGrid {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(180px,1fr));
    gap: 15px;
  }
  .deal-card {
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 6px;
    padding: 10px;
    cursor: pointer;
    transition: box-shadow 0.3s;
  }
  .deal-card:hover, .deal-card:focus {
    box-shadow: 0 0 10px #f08804;
    outline: none;
  }
  .deal-card img {
    max-height: 140px;
    margin-bottom: 8px;
    object-fit: contain;
    width: 100%;
  }
  .deal-title {
    font-weight: bold;
    font-size: 1rem;
    margin-bottom: 5px;
  }
  .deal-price {
    color: #b12704;
    font-weight: 700;
    margin-bottom: 5px;
  }
  .deal-badge {
    display: inline-block;
    background: #f08804;
    color: black;
    font-weight: 700;
    padding: 2px 6px;
    font-size: 0.75rem;
    border-radius: 4px;
  }
  /* Products grid */
  #productsSection {
    max-width: 1200px;
    margin: 30px auto 50px auto;
    padding: 0 15px;
  }
  #productsGrid {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(220px,1fr));
    gap: 20px;
  }
  .product-card {
    border: 1px solid #ddd;
    border-radius: 6px;
    background: #fff;
    padding: 10px;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    transition: box-shadow 0.3s;
  }
  .product-card:hover, .product-card:focus {
    box-shadow: 0 0 15px #f08804;
    outline: none;
  }
  .product-card img {
    height: 160px;
    object-fit: contain;
    margin-bottom: 10px;
  }
  .product-info {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
  }
  .product-title {
    font-weight: bold;
    font-size: 1rem;
    margin-bottom: 6px;
    flex-grow: 1;
  }
  .product-price {
    color: #b12704;
    font-weight: 700;
    margin-bottom: 6px;
    font-size: 1.1rem;
  }
  .product-rating {
    color: #ffa41c;
    font-size: 0.9rem;
  }
  /* Stars */
  i.fa-star,
  i.fa-star-half-stroke {
    color: #ffa41c;
  }
  i.fa-regular.fa-star {
    color: #ddd;
  }
  /* Badges for products */
  .badge {
    position: absolute;
    top: 8px;
    left: 8px;
    background: #f08804;
    color: black;
    font-weight: 700;
    padding: 2px 6px;
    font-size: 0.75rem;
    border-radius: 4px;
    user-select: none;
  }
  /* Product modal */
  #productModal {
    position: fixed;
    top: 50%;
    left: 50%;
    max-width: 900px;
    width: 90%;
    max-height: 85vh;
    background: white;
    border-radius: 10px;
    box-shadow: 0 0 15px #333;
    transform: translate(-50%, -50%);
    z-index: 1001;
    display: none;
    overflow: hidden;
    flex-direction: row;
  }
  #productModal.active {
    display: flex;
  }
  #modalLeft {
    flex: 1;
    padding: 20px;
    border-right: 1px solid #ddd;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  #modalLeft img {
    max-width: 100%;
    max-height: 400px;
    object-fit: contain;
  }
  #modalRight {
    flex: 1.2;
    padding: 20px;
    overflow-y: auto;
  }
  #modalTitle {
    font-size: 1.5rem;
    margin-bottom: 10px;
    font-weight: bold;
  }
  #modalRating {
    color: #ffa41c;
    margin-bottom: 10px;
  }
  #modalPrice {
    font-size: 1.4rem;
    font-weight: 700;
    color: #b12704;
    margin-bottom: 15px;
  }
  #modalDescription {
    font-size: 1rem;
    line-height: 1.4;
    margin-bottom: 20px;
  }
  #modalButtons {
    display: flex;
    gap: 15px;
  }
  #modalAddToCartBtn, #modalBuyNowBtn {
    background-color: #f08804;
    color: black;
    font-weight: 700;
    padding: 12px 20px;
    border-radius: 5px;
    flex: 1;
    text-align: center;
    transition: background-color 0.3s;
  }
  #modalAddToCartBtn:hover, #modalBuyNowBtn:hover {
    background-color: #ca7502;
  }
  #modalCloseBtn {
    position: absolute;
    top: 8px;
    right: 12px;
    font-size: 1.5rem;
    color: #333;
    cursor: pointer;
    user-select: none;
    background: none;
  }
  #modalCloseBtn:hover {
    color: #f08804;
  }
  /* Cart sidebar */
  #cartSidebar {
    position: fixed;
    top: 0;
    right: -400px;
    width: 360px;
    height: 100vh;
    background: white;
    box-shadow: -5px 0 20px rgba(0,0,0,0.2);
    transition: right 0.3s ease;
    z-index: 1002;
    display: flex;
    flex-direction: column;
  }
  #cartSidebar.open {
    right: 0;
  }
  #cartHeader {
    padding: 15px 20px;
    border-bottom: 1px solid #ddd;
    font-size: 1.25rem;
    font-weight: 700;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  #cartCloseBtn {
    font-size: 1.5rem;
    cursor: pointer;
    user-select: none;
    background: none;
  }
  #cartCloseBtn:hover {
    color: #f08804;
  }
  #cartItems {
    flex-grow: 1;
    overflow-y: auto;
    padding: 15px 20px;
  }
  .cart-item {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
  }
  .cart-item img {
    width: 70px;
    height: 70px;
    object-fit: contain;
    border: 1px solid #ddd;
    border-radius: 6px;
  }
  .cart-item-info {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }
  .cart-item-title {
    font-weight: 700;
    font-size: 1rem;
  }
  .cart-item-price {
    color: #b12704;
    font-weight: 700;
  }
  .cart-item-quantity {
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .qty-btn {
    background: #f08804;
    color: black;
    width: 24px;
    height: 24px;
    font-weight: 700;
    border-radius: 4px;
    text-align: center;
    line-height: 22px;
  }
  .qty-btn:hover {
    background: #ca7502;
  }
  .remove-item-btn {
    font-size: 1.2rem;
    color: #999;
    background: none;
    align-self: start;
    cursor: pointer;
    user-select: none;
  }
  .remove-item-btn:hover {
    color: #f08804;
  }
  #cartFooter {
    padding: 15px 20px;
    border-top: 1px solid #ddd;
  }
  #cartSubtotal {
    font-weight: 700;
    font-size: 1.2rem;
    margin-bottom: 15px;
  }
  #checkoutBtn {
    background-color: #f08804;
    color: black;
    font-weight: 700;
    padding: 12px 0;
    border-radius: 6px;
    width: 100%;
    font-size: 1.1rem;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  #checkoutBtn:hover {
    background-color: #ca7502;
  }
  /* Overlay */
  #overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.3);
    z-index: 1000;
    display: none;
  }
  #overlay.active {
    display: block;
  }
  /* Toast */
  #toast {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    background: #f08804;
    color: black;
    padding: 12px 24px;
    border-radius: 30px;
    font-weight: 700;
    font-size: 1rem;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    z-index: 1100;
  }
  #toast.show {
    opacity: 1;
    pointer-events: auto;
  }
  /* Responsive */
  @media (max-width: 600px) {
    #searchInput {
      width: 140px;
    }
    #cartSidebar {
      width: 100%;
      max-width: 360px;
    }
    #heroCarousel {
      max-width: 100%;
    }
  }
</style>
<!-- Font Awesome for stars -->
<script src="https://kit.fontawesome.com/4a2d6910cf.js" crossorigin="anonymous"></script>
</head>
<body>

<header>
  <div id="logo" tabindex="0">ZonMax</div>
  <input type="search" id="searchInput" aria-label="Search products" placeholder="Search products..." />
  <button id="cartBtn" aria-label="Open cart" aria-haspopup="true" aria-controls="cartSidebar">
    <i class="fas fa-shopping-cart"></i>
    <span id="cartCount" aria-live="polite" aria-atomic="true">0</span>
  </button>
</header>

<section id="heroCarousel" aria-label="Rotating deals banner">
  <button id="prevHero" aria-label="Previous deal">&#10094;</button>
  <img src="" alt="Deal Banner" id="heroImage" />
  <button id="nextHero" aria-label="Next deal">&#10095;</button>
</section>

<section id="dealsSection" aria-label="Deals and best sellers">
  <h2>Today's Deals & Best Sellers</h2>
  <div id="dealsGrid" role="list"></div>
</section>

<section id="productsSection" aria-label="Product listings">
  <h2>Products</h2>
  <div id="productsGrid" role="list"></div>
</section>

<!-- Product Detail Modal -->
<div id="productModal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" tabindex="-1">
  <button id="modalCloseBtn" aria-label="Close product details">&times;</button>
  <div id="modalLeft">
    <img src="" alt="" id="modalImage" />
  </div>
  <div id="modalRight">
    <h3 id="modalTitle"></h3>
    <div id="modalRating" aria-label="Product rating"></div>
    <div id="modalPrice"></div>
    <p id="modalDescription"></p>
    <div id="modalButtons">
      <button id="modalAddToCartBtn">Add to Cart</button>
      <button id="modalBuyNowBtn">Buy Now</button>
    </div>
  </div>
</div>

<!-- Cart Sidebar -->
<aside id="cartSidebar" aria-label="Shopping cart" aria-hidden="true">
  <header id="cartHeader">
    Your Cart
    <button id="cartCloseBtn" aria-label="Close cart">&times;</button>
  </header>
  <div id="cartItems" tabindex="0"></div>
  <footer id="cartFooter">
    <div id="cartSubtotal">Subtotal: $0.00</div>
    <button id="checkoutBtn">Proceed to Checkout</button>
  </footer>
</aside>

<div id="overlay" tabindex="-1"></div>
<div id="toast" role="alert" aria-live="assertive" aria-atomic="true"></div>

<script>
(() => {
  'use strict';

  // Product data
  const products = [
    {
      id: 1,
      title: "Wireless Noise Cancelling Headphones",
      description: "High-quality wireless headphones with active noise cancelling, long battery life, and premium sound.",
      price: 129.99,
      rating: 4.5,
      images: [
        "https://images.unsplash.com/photo-1511367461989-f85a21fda167?auto=format&fit=crop&w=600&q=80",
        "https://images.unsplash.com/photo-1517433456452-f9633a875f6f?auto=format&fit=crop&w=600&q=80"
      ],
      badge: "Best Seller"
    },
    {
      id: 2,
      title: "Smart Fitness Watch",
      description: "Track your workouts, heart rate, sleep, and more with this sleek smart fitness watch.",
      price: 89.99,
      rating: 4.0,
      images: [
        "https://images.unsplash.com/photo-1519741495975-1e644215b052?auto=format&fit=crop&w=600&q=80",
        "https://images.unsplash.com/photo-1526401485004-6e1a6deca88e?auto=format&fit=crop&w=600&q=80"
      ],
      badge: "Deal"
    },
    {
      id: 3,
      title: "Portable Bluetooth Speaker",
      description: "Compact and powerful Bluetooth speaker with rich bass and waterproof design.",
      price: 49.99,
      rating: 4.2,
      images: [
        "https://images.unsplash.com/photo-1509395176047-4a66953fd231?auto=format&fit=crop&w=600&q=80",
      ],
      badge: "Top Rated"
    },
    {
      id: 4,
      title: "4K Ultra HD Action Camera",
      description: "Capture stunning videos and photos with this 4K action camera, perfect for adventures.",
      price: 99.95,
      rating: 4.3,
      images: [
        "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?auto=format&fit=crop&w=600&q=80",
      ],
      badge: "Deal"
    },
    {
      id: 5,
      title: "Wireless Charging Pad",
      description: "Fast and convenient wireless charging pad compatible with all Qi-enabled devices.",
      price: 24.99,
      rating: 4.1,
      images: [
        "https://images.unsplash.com/photo-1555617117-08b384eff4b9?auto=format&fit=crop&w=600&q=80",
      ]
    },
    {
      id: 6,
      title: "Noise Isolating Earbuds",
      description: "Comfortable earbuds with noise isolation, deep bass, and crystal clear calls.",
      price: 39.50,
      rating: 4.0,
      images: [
        "https://images.unsplash.com/photo-1512436991641-6745cdb1723f?auto=format&fit=crop&w=600&q=80",
      ]
    },
    {
      id: 7,
      title: "Smart Home Voice Assistant",
      description: "Control your smart home with voice commands using this intelligent assistant device.",
      price: 79.99,
      rating: 4.4,
      images: [
        "https://images.unsplash.com/photo-1554384645-13eab165a171?auto=format&fit=crop&w=600&q=80",
      ],
      badge: "Best Seller"
    },
    {
      id: 8,
      title: "Ergonomic Wireless Mouse",
      description: "Comfortable wireless mouse with ergonomic design and adjustable DPI settings.",
      price: 29.99,
      rating: 4.3,
      images: [
        "https://images.unsplash.com/photo-1585079549074-cbade96fa7f8?auto=format&fit=crop&w=600&q=80",
      ]
    },
    {
      id: 9,
      title: "Mechanical Gaming Keyboard",
      description: "High-performance mechanical keyboard with customizable RGB lighting and tactile switches.",
      price: 79.90,
      rating: 4.6,
      images: [
        "https://images.unsplash.com/photo-1517336714731-489689fd1ca8?auto=format&fit=crop&w=600&q=80",
      ],
      badge: "Top Rated"
    },
    {
      id: 10,
      title: "USB-C Hub Multiport Adapter",
      description: "Expand your laptop's connectivity with this USB-C hub featuring HDMI, USB, and card reader.",
      price: 34.99,
      rating: 4.1,
      images: [
        "https://images.unsplash.com/photo-1555617117-08b384eff4b9?auto=format&fit=crop&w=600&q=80",
      ]
    },
    {
      id: 11,
      title: "Wireless Keyboard and Mouse Combo",
      description: "Sleek wireless keyboard and mouse combo for efficient productivity.",
      price: 54.99,
      rating: 4.2,
      images: [
        "https://images.unsplash.com/photo-1517336714731-489689fd1ca8?auto=format&fit=crop&w=600&q=80",
      ]
    },
    {
      id: 12,
      title: "Smartphone Gimbal Stabilizer",
      description: "Capture smooth video footage with this 3-axis smartphone gimbal stabilizer.",
      price: 119.99,
      rating: 4.5,
      images: [
        "https://images.unsplash.com/photo-1511367461989-f85a21fda167?auto=format&fit=crop&w=600&q=80",
      ]
    },
    {
      id: 13,
      title: "Adjustable Laptop Stand",
      description: "Ergonomic adjustable laptop stand to improve posture and reduce neck strain.",
      price: 39.99,
      rating: 4.0,
      images: [
        "https://images.unsplash.com/photo-1509395176047-4a66953fd231?auto=format&fit=crop&w=600&q=80",
      ]
    },
    {
      id: 14,
      title: "Bluetooth Noise Cancelling Earbuds",
      description: "True wireless earbuds with active noise cancelling and long battery life.",
      price: 69.99,
      rating: 4.3,
      images: [
        "https://images.unsplash.com/photo-1512436991641-6745cdb1723f?auto=format&fit=crop&w=600&q=80",
      ],
      badge: "Deal"
    },
    {
      id: 15,
      title: "Portable External SSD Drive",
      description: "High-speed portable external SSD drive with 1TB capacity.",
      price: 159.99,
      rating: 4.7,
      images: [
        "https://images.unsplash.com/photo-1526401485004-6e1a6deca88e?auto=format&fit=crop&w=600&q=80",
      ],
      badge: "Best Seller"
    }
  ];

  // Hero banners (using product images for banners)
  const heroBanners = [
    {img: "https://images.unsplash.com/photo-1517433456452-f9633a875f6f?auto=format&fit=crop&w=1200&q=90", alt: "Wireless Noise Cancelling Headphones Deal"},
    {img: "https://images.unsplash.com/photo-1519741495975-1e644215b052?auto=format&fit=crop&w=1200&q=90", alt: "Smart Fitness Watch Deal"},
    {img: "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?auto=format&fit=crop&w=1200&q=90", alt: "4K Ultra HD Action Camera Deal"},
    {img: "https://images.unsplash.com/photo-1511367461989-f85a21fda167?auto=format&fit=crop&w=1200&q=90", alt: "Bluetooth Gimbal Stabilizer Deal"},
  ];

  // DOM Elements
  const heroImage = document.getElementById("heroImage");
  const prevHeroBtn = document.getElementById("prevHero");
  const nextHeroBtn = document.getElementById("nextHero");
  const dealsGrid = document.getElementById("dealsGrid");
  const productsGrid = document.getElementById("productsGrid");
  const productModal = document.getElementById("productModal");
  const modalCloseBtn = document.getElementById("modalCloseBtn");
  const modalImage = document.getElementById("modalImage");
  const modalTitle = document.getElementById("modalTitle");
  const modalRating = document.getElementById("modalRating");
  const modalPrice = document.getElementById("modalPrice");
  const modalDescription = document.getElementById("modalDescription");
  const modalAddToCartBtn = document.getElementById("modalAddToCartBtn");
  const modalBuyNowBtn = document.getElementById("modalBuyNowBtn");
  const cartBtn = document.getElementById("cartBtn");
  const cartSidebar = document.getElementById("cartSidebar");
  const cartCloseBtn = document.getElementById("cartCloseBtn");
  const cartItemsContainer = document.getElementById("cartItems");
  const cartCount = document.getElementById("cartCount");
  const cartSubtotal = document.getElementById("cartSubtotal");
  const checkoutBtn = document.getElementById("checkoutBtn");
  const overlay = document.getElementById("overlay");
  const searchInput = document.getElementById("searchInput");
  const toast = document.getElementById("toast");

  // State
  let heroIndex = 0;
  let currentProduct = null;
  let cart = {}; // {productId: quantity}

  // Load cart from localStorage
  function loadCart() {
    const cartStr = localStorage.getItem("zonmaxCart");
    if (cartStr) {
      try {
        cart = JSON.parse(cartStr);
      } catch {
        cart = {};
      }
    }
  }
  // Save cart to localStorage
  function saveCart() {
    localStorage.setItem("zonmaxCart", JSON.stringify(cart));
  }

  // Show toast notification
  function showToast(message) {
    toast.textContent = message;
    toast.classList.add("show");
    setTimeout(() => {
      toast.classList.remove("show");
    }, 2500);
  }

  // Format price
  function formatPrice(price) {
    return "$" + price.toFixed(2);
  }

  // Render stars for rating (0 to 5)
  function renderStars(rating) {
    const fullStars = Math.floor(rating);
    const halfStar = rating - fullStars >= 0.5;
    let starsHTML = "";
    for (let i = 0; i < fullStars; i++) {
      starsHTML += '<i class="fas fa-star"></i>';
    }
    if (halfStar) {
      starsHTML += '<i class="fas fa-star-half-stroke"></i>';
    }
    const emptyStars = 5 - fullStars - (halfStar ? 1 : 0);
    for (let i = 0; i < emptyStars; i++) {
      starsHTML += '<i class="far fa-star"></i>';
    }
    return starsHTML;
  }

  // Render hero banner
  function renderHero() {
    const banner = heroBanners[heroIndex];
    heroImage.src = banner.img;
    heroImage.alt = banner.alt;
  }

  // Cycle hero banner next
  function nextHero() {
    heroIndex = (heroIndex + 1) % heroBanners.length;
    renderHero();
  }
  // Cycle hero banner prev
  function prevHero() {
    heroIndex = (heroIndex - 1 + heroBanners.length) % heroBanners.length;
    renderHero();
  }

  // Render deals grid (best sellers, deals, top rated)
  function renderDeals() {
    // Filter products with badge
    const deals = products.filter(p => p.badge);
    dealsGrid.innerHTML = "";
    deals.forEach(product => {
      const card = document.createElement("div");
      card.className = "deal-card";
      card.tabIndex = 0;
      card.setAttribute("role", "listitem");
      card.setAttribute("aria-label", `${product.title}, price ${formatPrice(product.price)}, badge: ${product.badge}`);

      card.innerHTML = `
        <img src="${product.images[0]}" alt="${product.title}" />
        <div class="deal-title">${product.title}</div>
        <div class="deal-price">${formatPrice(product.price)}</div>
        <div class="deal-badge">${product.badge}</div>
      `;
      card.addEventListener("click", () => openProductModal(product.id));
      card.addEventListener("keydown", e => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          openProductModal(product.id);
        }
      });
      dealsGrid.appendChild(card);
    });
  }

  // Render products grid with search filter
  function renderProducts(filter = "") {
    const filtered = products.filter(p => p.title.toLowerCase().includes(filter.toLowerCase()));
    productsGrid.innerHTML = "";
    filtered.forEach(product => {
      const card = document.createElement("div");
      card.className = "product-card";
      card.tabIndex = 0;
      card.setAttribute("role", "listitem");
      card.setAttribute("aria-label", `${product.title}, price ${formatPrice(product.price)}`);

      card.innerHTML = `
        <img src="${product.images[0]}" alt="${product.title}" />
        <div class="product-info">
          <h3>${product.title}</h3>
          <div class="rating" aria-label="Rating: ${product.rating} out of 5 stars">${renderStars(product.rating)}</div>
          <div class="price">${formatPrice(product.price)}</div>
        </div>
      `;
      card.addEventListener("click", () => openProductModal(product.id));
      card.addEventListener("keydown", e => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          openProductModal(product.id);
        }
      });
      productsGrid.appendChild(card);
    });
  }

  // Open product modal by product id
  function openProductModal(productId) {
    currentProduct = products.find(p => p.id === productId);
    if (!currentProduct) return;
    modalImage.src = currentProduct.images[0];
    modalImage.alt = currentProduct.title;
    modalTitle.textContent = currentProduct.title;
    modalRating.innerHTML = renderStars(currentProduct.rating);
    modalPrice.textContent = formatPrice(currentProduct.price);
    modalDescription.textContent = currentProduct.description;

    productModal.style.display = "flex";
    productModal.focus();
    overlay.classList.add("active");
    cartSidebar.setAttribute("aria-hidden", "true");
  }

  // Close product modal
  function closeProductModal() {
    productModal.style.display = "none";
    overlay.classList.remove("active");
    currentProduct = null;
  }

  // Update cart display count
  function updateCartCount() {
    const count = Object.values(cart).reduce((a,b) => a+b, 0);
    cartCount.textContent = count;
    cartBtn.setAttribute("aria-label", `Open cart. ${count} items in cart.`);
  }

  // Render cart items in sidebar
  function renderCart() {
    cartItemsContainer.innerHTML = "";
    const productIds = Object.keys(cart);
    if (productIds.length === 0) {
      cartItemsContainer.innerHTML = "<p>Your cart is empty.</p>";
      cartSubtotal.textContent = "Subtotal: $0.00";
      checkoutBtn.disabled = true;
      return;
    }
    let subtotal = 0;
    productIds.forEach(pid => {
      const product = products.find(p => p.id === +pid);
      const quantity = cart[pid];
      if (!product) return;
      const itemTotal = product.price * quantity;
      subtotal += itemTotal;

      const itemDiv = document.createElement("div");
      itemDiv.className = "cart-item";
      itemDiv.setAttribute("role", "listitem");
      itemDiv.innerHTML = `
        <img src="${product.images[0]}" alt="${product.title}" />
        <div class="cart-item-info">
          <h4>${product.title}</h4>
          <div>Price: ${formatPrice(product.price)}</div>
          <div>
            Quantity:
            <button class="qty-btn" data-action="decrease" aria-label="Decrease quantity for ${product.title}">-</button>
            <span aria-live="polite" aria-atomic="true" class="qty">${quantity}</span>
            <button class="qty-btn" data-action="increase" aria-label="Increase quantity for ${product.title}">+</button>
          </div>
          <div>Total: ${formatPrice(itemTotal)}</div>
          <button class="remove-btn" aria-label="Remove ${product.title} from cart">Remove</button>
        </div>
      `;
      // Event listeners for quantity buttons and remove button
      const decreaseBtn = itemDiv.querySelector("button[data-action='decrease']");
      const increaseBtn = itemDiv.querySelector("button[data-action='increase']");
      const removeBtn = itemDiv.querySelector(".remove-btn");

      decreaseBtn.addEventListener("click", () => {
        if (cart[pid] > 1) {
          cart[pid]--;
        } else {
          delete cart[pid];
        }
        saveCart();
        updateCartCount();
        renderCart();
        showToast(`Decreased quantity of "${product.title}"`);
      });
      increaseBtn.addEventListener("click", () => {
        cart[pid]++;
        saveCart();
        updateCartCount();
        renderCart();
        showToast(`Increased quantity of "${product.title}"`);
      });
      removeBtn.addEventListener("click", () => {
        delete cart[pid];
        saveCart();
        updateCartCount();
        renderCart();
        showToast(`Removed "${product.title}" from cart`);
      });

      cartItemsContainer.appendChild(itemDiv);
    });
    cartSubtotal.textContent = `Subtotal: ${formatPrice(subtotal)}`;
    checkoutBtn.disabled = false;
  }

  // Add product to cart
  function addToCart(productId) {
    if (!cart[productId]) {
      cart[productId] = 1;
    } else {
      cart[productId]++;
    }
    saveCart();
    updateCartCount();
    renderCart();
    showToast(`Added "${products.find(p => p.id === productId).title}" to cart`);
  }

  // Event Listeners

  // Hero carousel navigation
  nextHeroBtn.addEventListener("click", () => {
    nextHero();
  });
  prevHeroBtn.addEventListener("click", () => {
    prevHero();
  });

  // Auto cycle hero every 6 seconds
  setInterval(() => {
    nextHero();
  }, 6000);

  // Open product modal from modal buttons
  modalAddToCartBtn.addEventListener("click", () => {
    if (currentProduct) {
      addToCart(currentProduct.id);
    }
  });
  modalBuyNowBtn.addEventListener("click", () => {
    if (currentProduct) {
      addToCart(currentProduct.id);
      cartSidebar.style.left = "0";
      cartSidebar.setAttribute("aria-hidden", "false");
      overlay.classList.add("active");
      productModal.style.display = "none";
    }
  });

  // Close modal
  modalCloseBtn.addEventListener("click", closeProductModal);
  overlay.addEventListener("click", () => {
    closeProductModal();
    closeCartSidebar();
  });

  // Keyboard navigation for modal (Escape to close)
  window.addEventListener("keydown", e => {
    if (e.key === "Escape") {
      if (productModal.style.display === "flex") {
        closeProductModal();
      }
      if (cartSidebar.style.left === "0px" || cartSidebar.style.left === "0") {
        closeCartSidebar();
      }
    }
  });

  // Cart button open/close
  cartBtn.addEventListener("click", () => {
    openCartSidebar();
  });
  cartCloseBtn.addEventListener("click", () => {
    closeCartSidebar();
  });

  // Open cart sidebar
  function openCartSidebar() {
    cartSidebar.style.left = "0";
    cartSidebar.setAttribute("aria-hidden", "false");
    overlay.classList.add("active");
    productModal.style.display = "none";
  }
  // Close cart sidebar
  function closeCartSidebar() {
    cartSidebar.style.left = "-400px";
    cartSidebar.setAttribute("aria-hidden", "true");
    overlay.classList.remove("active");
  }

  // Search input filter products
  searchInput.addEventListener("input", e => {
    renderProducts(e.target.value);
  });

  // Checkout button click (simulate)
  checkoutBtn.addEventListener("click", () => {
    if (Object.keys(cart).length === 0) {
      showToast("Your cart is empty.");
      return;
    }
    alert("Proceeding to checkout (simulation). Thank you for shopping with ZonMax!");
    cart = {};
    saveCart();
    updateCartCount();
    renderCart();
    closeCartSidebar();
  });

  // Initialize app
  function init() {
    loadCart();
    renderHero();
    renderDeals();
    renderProducts();
    updateCartCount();
    renderCart();
  }

  init();

})();
</script>

</body>
</html>
