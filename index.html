<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Amazon-Lite Online Store</title>
<style>
  /* Reset & basics */
  * {
    box-sizing: border-box;
  }
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    background: #f4f4f4;
    color: #111;
    min-height: 100vh;
  }
  header {
    background: #232f3e;
    color: white;
    padding: 12px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
  }
  header h1 {
    margin: 0;
    font-weight: 700;
    cursor: pointer;
  }
  header .search-bar {
    flex: 1;
    margin: 10px 20px;
    max-width: 500px;
    position: relative;
  }
  header .search-bar input {
    width: 100%;
    padding: 8px 12px;
    border-radius: 4px 0 0 4px;
    border: none;
    font-size: 1rem;
  }
  header .search-bar button {
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    background: #febd69;
    border: none;
    padding: 0 16px;
    border-radius: 0 4px 4px 0;
    cursor: pointer;
    font-weight: 700;
  }
  header .nav-buttons button {
    margin-left: 10px;
    background: transparent;
    border: none;
    color: white;
    font-weight: 600;
    cursor: pointer;
    position: relative;
  }
  header .nav-buttons button:hover {
    text-decoration: underline;
  }
  header .nav-buttons #cart-count {
    position: absolute;
    top: -6px;
    right: -10px;
    background: #f08804;
    border-radius: 50%;
    color: white;
    font-size: 0.75rem;
    padding: 2px 6px;
  }
  nav.categories {
    background: #37475a;
    display: flex;
    overflow-x: auto;
    padding: 8px 20px;
  }
  nav.categories button {
    background: transparent;
    border: none;
    color: white;
    padding: 8px 14px;
    margin-right: 12px;
    cursor: pointer;
    white-space: nowrap;
    font-weight: 600;
    border-radius: 4px;
  }
  nav.categories button.active,
  nav.categories button:hover {
    background: #febd69;
    color: #111;
  }

  main {
    padding: 20px;
    max-width: 1200px;
    margin: 0 auto;
  }
  .product-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill,minmax(220px,1fr));
    gap: 20px;
  }
  .product-card {
    background: white;
    border-radius: 6px;
    box-shadow: 0 0 7px rgb(0 0 0 / 0.1);
    cursor: pointer;
    display: flex;
    flex-direction: column;
    transition: box-shadow 0.2s ease;
  }
  .product-card:hover {
    box-shadow: 0 0 12px rgb(0 0 0 / 0.2);
  }
  .product-card img {
    width: 100%;
    border-radius: 6px 6px 0 0;
    object-fit: contain;
    height: 180px;
    background: #fff;
  }
  .product-info {
    padding: 10px 14px;
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }
  .product-info h3 {
    margin: 0 0 8px 0;
    font-size: 1rem;
    font-weight: 700;
    color: #111;
  }
  .price {
    color: #b12704;
    font-weight: 700;
    margin-bottom: 6px;
    font-size: 1.1rem;
  }
  .rating {
    color: #ff9900;
    font-weight: 700;
    font-size: 0.9rem;
  }
  .product-card button {
    background: #febd69;
    border: none;
    padding: 10px;
    font-weight: 700;
    color: #111;
    cursor: pointer;
    border-radius: 0 0 6px 6px;
    transition: background 0.3s ease;
  }
  .product-card button:hover {
    background: #f3a847;
  }

  /* Modal */
  .modal-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.6);
    display: none;
    justify-content: center;
    align-items: center;
    padding: 20px;
    z-index: 1000;
  }
  .modal-backdrop.active {
    display: flex;
  }
  .modal-content {
    background: white;
    max-width: 700px;
    width: 100%;
    border-radius: 8px;
    overflow-y: auto;
    max-height: 90vh;
    padding: 20px;
    position: relative;
  }
  .modal-close {
    position: absolute;
    right: 20px;
    top: 18px;
    font-size: 28px;
    cursor: pointer;
    color: #999;
    font-weight: 700;
  }
  .modal-close:hover {
    color: #555;
  }
  .modal-product-image {
    max-width: 300px;
    max-height: 300px;
    object-fit: contain;
    margin-bottom: 20px;
  }
  .modal-title {
    margin: 0 0 10px;
    font-weight: 700;
    font-size: 1.5rem;
  }
  .modal-price {
    font-weight: 700;
    font-size: 1.3rem;
    color: #b12704;
    margin-bottom: 10px;
  }
  .modal-rating {
    font-weight: 700;
    color: #ff9900;
    margin-bottom: 20px;
  }
  .modal-description {
    font-size: 1rem;
    margin-bottom: 20px;
  }
  .modal-variants label {
    font-weight: 600;
  }
  .modal-variants select {
    padding: 6px;
    margin-left: 10px;
    border-radius: 4px;
    border: 1px solid #ccc;
  }
  .modal-actions {
    display: flex;
    gap: 12px;
  }
  .modal-actions button {
    flex: 1;
    background: #febd69;
    border: none;
    font-weight: 700;
    padding: 12px;
    border-radius: 6px;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  .modal-actions button:hover {
    background: #f3a847;
  }

  /* Cart Sidebar */
  .sidebar {
    position: fixed;
    top: 0; right: 0;
    width: 320px;
    height: 100vh;
    background: white;
    box-shadow: -3px 0 10px rgba(0,0,0,0.15);
    transform: translateX(100%);
    transition: transform 0.3s ease;
    z-index: 1500;
    display: flex;
    flex-direction: column;
  }
  .sidebar.active {
    transform: translateX(0);
  }
  .sidebar-header {
    padding: 15px 20px;
    background: #232f3e;
    color: white;
    font-weight: 700;
    font-size: 1.2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .sidebar-header button {
    background: transparent;
    border: none;
    color: white;
    font-size: 24px;
    cursor: pointer;
  }
  .sidebar-content {
    flex-grow: 1;
    overflow-y: auto;
    padding: 20px;
  }
  .cart-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 14px;
    align-items: center;
  }
  .cart-item-title {
    font-weight: 600;
  }
  .cart-item-qty {
    font-size: 0.9rem;
    color: #555;
  }
  .cart-item-controls button {
    margin-left: 8px;
    background: #febd69;
    border: none;
    padding: 6px 10px;
    font-weight: 700;
    cursor: pointer;
    border-radius: 4px;
  }
  .sidebar-footer {
    padding: 15px 20px;
    border-top: 1px solid #ccc;
  }
  .sidebar-footer .total {
    font-weight: 700;
    font-size: 1.2rem;
    margin-bottom: 12px;
  }
  .sidebar-footer button {
    width: 100%;
    background: #febd69;
    border: none;
    padding: 12px;
    font-weight: 700;
    border-radius: 6px;
    cursor: pointer;
  }
  .sidebar-footer button:hover {
    background: #f3a847;
  }

  /* Wishlist Modal */
  .wishlist-modal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.6);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1600;
  }
  .wishlist-modal.active {
    display: flex;
  }
  .wishlist-content {
    background: white;
    max-width: 600px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    border-radius: 8px;
    padding: 20px;
    position: relative;
  }
  .wishlist-close {
    position: absolute;
    top: 14px;
    right: 20px;
    font-size: 28px;
    cursor: pointer;
    font-weight: 700;
    color: #999;
  }
  .wishlist-close:hover {
    color: #555;
  }
  .wishlist-item {
    display: flex;
    align-items: center;
    margin-bottom: 12px;
  }
  .wishlist-item img {
    width: 60px;
    height: 60px;
    object-fit: contain;
    margin-right: 12px;
  }
  .wishlist-item-info {
    flex-grow: 1;
  }
  .wishlist-item-title {
    font-weight: 600;
  }
  .wishlist-item-price {
    color: #b12704;
    font-weight: 700;
  }
  .wishlist-item-remove {
    background: #febd69;
    border: none;
    padding: 6px 10px;
    cursor: pointer;
    font-weight: 700;
    border-radius: 4px;
  }

  /* Auth Modal */
  .auth-modal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.6);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 2000;
  }
  .auth-modal.active {
    display: flex;
  }
  .auth-content {
    background: white;
    max-width: 400px;
    width: 90%;
    border-radius: 8px;
    padding: 20px;
    position: relative;
  }
  .auth-close {
    position: absolute;
    top: 14px;
    right: 20px;
    font-size: 28px;
    cursor: pointer;
    font-weight: 700;
    color: #999;
  }
  .auth-close:hover {
    color: #555;
  }
  .auth-content h2 {
    margin: 0 0 20px;
  }
  .auth-content form {
    display: flex;
    flex-direction: column;
  }
  .auth-content label {
    margin-bottom: 4px;
    font-weight: 600;
  }
  .auth-content input {
    padding: 10px;
    margin-bottom: 14px;
    border-radius: 4px;
    border: 1px solid #ccc;
    font-size: 1rem;
  }
  .auth-content button {
    background: #febd69;
    border: none;
    padding: 12px;
    font-weight: 700;
    border-radius: 6px;
    cursor: pointer;
  }
  .auth-content button:hover {
    background: #f3a847;
  }
  .auth-switch {
    margin-top: 10px;
    font-size: 0.9rem;
    cursor: pointer;
    color: #0066c0;
    text-decoration: underline;
  }
  .auth-switch:hover {
    color: #004080;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .sidebar {
      width: 100%;
      max-width: none;
    }
    header {
      justify-content: center;
      gap: 12px;
    }
    header h1 {
      flex: 1 0 100%;
      text-align: center;
    }
    header .search-bar {
      max-width: 100%;
      margin: 10px 0 0 0;
    }
    nav.categories {
      padding: 8px 10px;
    }
  }
</style>
</head>
<body>

<header>
  <h1 id="logo">Amazon-Lite</h1>
  <div class="search-bar">
    <input type="text" id="search-input" placeholder="Search products..." />
    <button id="search-btn">Search</button>
  </div>
  <div class="nav-buttons">
    <button id="btn-login">Login</button>
    <button id="btn-logout" style="display:none;">Logout (<span id="user-email"></span>)</button>
    <button id="wishlist-btn">Wishlist</button>
    <button id="cart-btn">Cart <span id="cart-count" style="display:none;">0</span></button>
  </div>
</header>

<nav class="categories" aria-label="Product Categories">
  <button class="category-btn active" data-category="all">All</button>
  <button class="category-btn" data-category="electronics">Electronics</button>
  <button class="category-btn" data-category="books">Books</button>
  <button class="category-btn" data-category="clothing">Clothing</button>
  <button class="category-btn" data-category="home">Home</button>
  <button class="category-btn" data-category="toys">Toys</button>
</nav>

<main>
  <section class="product-grid" id="product-grid" aria-live="polite" aria-atomic="true">
    <!-- Products go here -->
  </section>
</main>

<!-- Product Modal -->
<div class="modal-backdrop" id="product-modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-describedby="modal-description">
  <div class="modal-content">
    <span class="modal-close" id="modal-close" aria-label="Close">&times;</span>
    <img src="" alt="" class="modal-product-image" id="modal-image" />
    <h2 class="modal-title" id="modal-title"></h2>
    <div class="modal-price" id="modal-price"></div>
    <div class="modal-rating" id="modal-rating"></div>
    <div class="modal-description" id="modal-description"></div>
    <div class="modal-variants" id="modal-variants"></div>
    <div class="modal-actions">
      <button id="modal-add-cart">Add to Cart</button>
      <button id="modal-add-wishlist">Add to Wishlist</button>
    </div>
  </div>
</div>

<!-- Cart Sidebar -->
<aside class="sidebar" id="cart-sidebar" aria-label="Shopping cart">
  <div class="sidebar-header">
    Cart
    <button id="cart-close-btn" aria-label="Close cart">&times;</button>
  </div>
  <div class="sidebar-content" id="cart-items-container">
    <!-- Cart items here -->
  </div>
  <div class="sidebar-footer">
    <div class="total" id="cart-total">Total: $0.00</div>
    <button id="checkout-btn">Proceed to Checkout</button>
  </div>
</aside>

<!-- Wishlist Modal -->
<div class="wishlist-modal" id="wishlist-modal" role="dialog" aria-modal="true" aria-labelledby="wishlist-title">
  <div class="wishlist-content">
    <span class="wishlist-close" id="wishlist-close-btn" aria-label="Close wishlist">&times;</span>
    <h2 id="wishlist-title">Your Wishlist</h2>
    <div id="wishlist-items">
      <!-- Wishlist items here -->
    </div>
  </div>
</div>

<!-- Auth Modal -->
<div class="auth-modal" id="auth-modal" role="dialog" aria-modal="true" aria-labelledby="auth-title">
  <div class="auth-content">
    <span class="auth-close" id="auth-close-btn" aria-label="Close login form">&times;</span>
    <h2 id="auth-title">Login</h2>
    <form id="auth-form">
      <label for="email">Email:</label>
      <input type="email" id="email" name="email" required autocomplete="username" />
      <label for="password">Password:</label>
      <input type="password" id="password" name="password" required autocomplete="current-password" />
      <button type="submit" id="auth-submit-btn">Login</button>
    </form>
    <div id="auth-switch" class="auth-switch">Don't have an account? Register here</div>
  </div>
</div>

<script>
(() => {
  // Product data
  const products = [
    {
      id: 'p1',
      title: 'Apple iPhone 14 Pro Max',
      category: 'electronics',
      price: 1099.99,
      rating: 4.8,
      description: 'Latest Apple iPhone with A16 Bionic chip, ProMotion display, and amazing camera system.',
      image: 'https://images.unsplash.com/photo-1661961117489-b7a7f2f69f5f?auto=format&fit=crop&w=400&q=80',
      variants: ['128GB', '256GB', '512GB', '1TB']
    },
    {
      id: 'p2',
      title: 'Sony WH-1000XM5 Wireless Headphones',
      category: 'electronics',
      price: 399.99,
      rating: 4.7,
      description: 'Industry-leading noise cancelling wireless headphones with 30-hour battery life.',
      image: 'https://images.unsplash.com/photo-1526170375885-4d8ecf77b99f?auto=format&fit=crop&w=400&q=80',
      variants: ['Black', 'Silver']
    },
    {
      id: 'p3',
      title: 'The Alchemist by Paulo Coelho',
      category: 'books',
      price: 15.99,
      rating: 4.5,
      description: 'An inspiring novel about following your dreams and listening to your heart.',
      image: 'https://images.unsplash.com/photo-1512820790803-83ca734da794?auto=format&fit=crop&w=400&q=80',
      variants: ['Paperback', 'Hardcover', 'Kindle']
    },
    {
      id: 'p4',
      title: 'Levi’s 501 Original Fit Jeans',
      category: 'clothing',
      price: 59.99,
      rating: 4.3,
      description: 'Classic straight leg jeans with authentic Levi’s style and comfort.',
      image: 'https://images.unsplash.com/photo-1521334884684-d80222895322?auto=format&fit=crop&w=400&q=80',
      variants: ['30', '32', '34', '36']
    },
    {
      id: 'p5',
      title: 'Instant Pot Duo 7-in-1 Electric Pressure Cooker',
      category: 'home',
      price: 89.95,
      rating: 4.7,
      description: 'Multifunctional pressure cooker, slow cooker, rice cooker, and more.',
      image: 'https://images.unsplash.com/photo-1601045049139-0b0e21f2c99e?auto=format&fit=crop&w=400&q=80',
      variants: []
    },
    {
      id: 'p6',
      title: 'LEGO Star Wars Millennium Falcon',
      category: 'toys',
      price: 159.99,
      rating: 4.9,
      description: 'Ultimate collector’s edition LEGO Millennium Falcon with 7,541 pieces.',
      image: 'https://images.unsplash.com/photo-1618354694161-51b5970f16e4?auto=format&fit=crop&w=400&q=80',
      variants: []
    },
    {
      id: 'p7',
      title: 'Samsung 55" QLED 4K Smart TV',
      category: 'electronics',
      price: 699.99,
      rating: 4.6,
      description: 'Stunning 4K QLED display with smart TV features and voice control.',
      image: 'https://images.unsplash.com/photo-1582473359310-cd7039a647c6?auto=format&fit=crop&w=400&q=80',
      variants: []
    },
    {
      id: 'p8',
      title: 'Nike Air Max 270 Shoes',
      category: 'clothing',
      price: 129.99,
      rating: 4.4,
      description: 'Comfortable and stylish sneakers with a large Air Max unit.',
      image: 'https://images.unsplash.com/photo-1528701800489-0b5ccf5f13e9?auto=format&fit=crop&w=400&q=80',
      variants: ['8', '9', '10', '11']
    },
    {
      id: 'p9',
      title: 'Hamilton Beach Coffee Maker',
      category: 'home',
      price: 49.99,
      rating: 4.1,
      description: 'Simple and efficient coffee maker with programmable timer.',
      image: 'https://images.unsplash.com/photo-1509042239860-f550ce710b93?auto=format&fit=crop&w=400&q=80',
      variants: []
    },
    {
      id: 'p10',
      title: 'Harry Potter and the Sorcerer’s Stone',
      category: 'books',
      price: 12.99,
      rating: 4.8,
      description: 'The first book in the beloved Harry Potter series by J.K. Rowling.',
      image: 'https://images.unsplash.com/photo-1524995997946-a1c2e315a42f?auto=format&fit=crop&w=400&q=80',
      variants: ['Paperback', 'Hardcover', 'Audiobook']
    }
  ];

  // State
  let filteredCategory = 'all';
  let cart = [];
  let wishlist = [];
  let loggedInUser = null;

  // DOM references
  const productGrid = document.getElementById('product-grid');
  const cartSidebar = document.getElementById('cart-sidebar');
  const cartItemsContainer = document.getElementById('cart-items-container');
  const cartTotalElem = document.getElementById('cart-total');
  const cartCountElem = document.getElementById('cart-count');
  const wishlistModal = document.getElementById('wishlist-modal');
  const wishlistItems = document.getElementById('wishlist-items');
  const authModal = document.getElementById('auth-modal');
  const authForm = document.getElementById('auth-form');
  const authTitle = document.getElementById('auth-title');
  const authSubmitBtn = document.getElementById('auth-submit-btn');
  const authSwitch = document.getElementById('auth-switch');
  const btnLogin = document.getElementById('btn-login');
  const btnLogout = document.getElementById('btn-logout');
  const userEmailDisplay = document.getElementById('user-email');
  const wishlistBtn = document.getElementById('wishlist-btn');
  const cartBtn = document.getElementById('cart-btn');
  const modal = document.getElementById('product-modal');
  const modalClose = document.getElementById('modal-close');
  const modalImage = document.getElementById('modal-image');
  const modalTitle = document.getElementById('modal-title');
  const modalPrice = document.getElementById('modal-price');
  const modalRating = document.getElementById('modal-rating');
  const modalDescription = document.getElementById('modal-description');
  const modalVariants = document.getElementById('modal-variants');
  const modalAddCart = document.getElementById('modal-add-cart');
  const modalAddWishlist = document.getElementById('modal-add-wishlist');
  const categoryButtons = document.querySelectorAll('.category-btn');

  let currentProduct = null;

  // Utility functions
  function formatPrice(price) {
    return `$${price.toFixed(2)}`;
  }

  function updateCartCount() {
    const count = cart.reduce((acc, item) => acc + item.quantity, 0);
    if (count > 0) {
      cartCountElem.style.display = 'inline-block';
      cartCountElem.textContent = count;
    } else {
      cartCountElem.style.display = 'none';
    }
  }

  function renderProducts() {
    productGrid.innerHTML = '';
    let visibleProducts = filteredCategory === 'all' ? products : products.filter(p => p.category === filteredCategory);
    if(visibleProducts.length === 0){
      productGrid.innerHTML = '<p>No products found in this category.</p>';
      return;
    }
    visibleProducts.forEach(product => {
      const productElem = document.createElement('article');
      productElem.className = 'product-card';
      productElem.tabIndex = 0;
      productElem.setAttribute('aria-label', `${product.title}, Price: ${formatPrice(product.price)}, Rating: ${product.rating}`);
      productElem.innerHTML = `
        <img src="${product.image}" alt="${product.title}" />
        <h3>${product.title}</h3>
        <div class="price">${formatPrice(product.price)}</div>
        <div class="rating">⭐ ${product.rating.toFixed(1)}</div>
        <button aria-label="View details for ${product.title}">View Details</button>
      `;
      productGrid.appendChild(productElem);

      productElem.querySelector('button').addEventListener('click', () => openProductModal(product));
      productElem.addEventListener('keydown', e => {
        if(e.key === 'Enter') openProductModal(product);
      });
    });
  }

  function openProductModal(product) {
    currentProduct = product;
    modalImage.src = product.image;
    modalImage.alt = product.title;
    modalTitle.textContent = product.title;
    modalPrice.textContent = formatPrice(product.price);
    modalRating.textContent = `⭐ ${product.rating.toFixed(1)}`;
    modalDescription.textContent = product.description;

    // Variants
    modalVariants.innerHTML = '';
    if(product.variants.length > 0){
      const variantLabel = document.createElement('label');
      variantLabel.textContent = 'Choose option: ';
      variantLabel.setAttribute('for', 'variant-select');
      modalVariants.appendChild(variantLabel);

      const variantSelect = document.createElement('select');
      variantSelect.id = 'variant-select';
      product.variants.forEach(v => {
        const opt = document.createElement('option');
        opt.value = v;
        opt.textContent = v;
        variantSelect.appendChild(opt);
      });
      modalVariants.appendChild(variantSelect);
    }

    modal.classList.add('active');
    modal.focus();
  }

  function closeProductModal() {
    modal.classList.remove('active');
    currentProduct = null;
  }

  function addToCart(product, variant=null) {
    const existingIndex = cart.findIndex(item => item.id === product.id && item.variant === variant);
    if(existingIndex > -1){
      cart[existingIndex].quantity++;
    } else {
      cart.push({id: product.id, title: product.title, price: product.price, variant, quantity: 1});
    }
    updateCartSidebar();
    updateCartCount();
    alert(`Added ${product.title}${variant ? ` (${variant})` : ''} to cart.`);
  }

  function removeFromCart(productId, variant=null) {
    cart = cart.filter(item => !(item.id === productId && item.variant === variant));
    updateCartSidebar();
    updateCartCount();
  }

  function updateCartSidebar() {
    cartItemsContainer.innerHTML = '';
    if(cart.length === 0){
      cartItemsContainer.innerHTML = '<p>Your cart is empty.</p>';
      cartTotalElem.textContent = 'Total: $0.00';
      return;
    }
    let total = 0;
    cart.forEach(item => {
      total += item.price * item.quantity;
      const cartItem = document.createElement('div');
      cartItem.className = 'cart-item';
      cartItem.innerHTML = `
        <div class="cart-item-info">
          <div class="cart-item-title">${item.title}${item.variant ? ` (${item.variant})` : ''}</div>
          <div class="cart-item-price">${formatPrice(item.price)}</div>
          <div class="cart-item-quantity">Quantity: ${item.quantity}</div>
        </div>
        <div class="cart-item-controls">
          <button aria-label="Remove ${item.title} from cart">Remove</button>
        </div>
      `;
      cartItemsContainer.appendChild(cartItem);

      cartItem.querySelector('button').addEventListener('click', () => removeFromCart(item.id, item.variant));
    });
    cartTotalElem.textContent = `Total: ${formatPrice(total)}`;
  }

  // Wishlist functions
  function toggleWishlistModal(show) {
    wishlistModal.classList.toggle('active', show);
    if(show) renderWishlist();
  }

  function renderWishlist() {
    wishlistItems.innerHTML = '';
    if(wishlist.length === 0){
      wishlistItems.innerHTML = '<p>Your wishlist is empty.</p>';
      return;
    }
    wishlist.forEach(item => {
      const wishElem = document.createElement('div');
      wishElem.className = 'wishlist-item';
      wishElem.innerHTML = `
        <img src="${item.image}" alt="${item.title}" />
        <div class="wishlist-item-info">
          <div class="wishlist-item-title">${item.title}</div>
          <div class="wishlist-item-price">${formatPrice(item.price)}</div>
        </div>
        <button aria-label="Remove ${item.title} from wishlist" class="wishlist-item-remove">Remove</button>
      `;
      wishlistItems.appendChild(wishElem);
      wishElem.querySelector('button').addEventListener('click', () => {
        wishlist = wishlist.filter(w => w.id !== item.id);
        renderWishlist();
      });
    });
  }

  function addToWishlist(product) {
    if(!wishlist.some(w => w.id === product.id)){
      wishlist.push(product);
      alert(`Added ${product.title} to wishlist.`);
    } else {
      alert(`${product.title} is already in your wishlist.`);
    }
  }

  // Auth functions (simplified fake login for demo)
  function toggleAuthModal(show) {
    authModal.classList.toggle('active', show);
  }

  btnLogin.addEventListener('click', () => toggleAuthModal(true));
  document.getElementById('auth-close-btn').addEventListener('click', () => toggleAuthModal(false));
  authSwitch.addEventListener('click', () => {
    if(authTitle.textContent === 'Login'){
      authTitle.textContent = 'Register';
      authSubmitBtn.textContent = 'Register';
      authSwitch.textContent = 'Already have an account? Login here';
    } else {
      authTitle.textContent = 'Login';
      authSubmitBtn.textContent = 'Login';
      authSwitch.textContent = "Don't have an account? Register here";
    }
  });

  authForm.addEventListener('submit', e => {
    e.preventDefault();
    const email = authForm.email.value.trim();
    const password = authForm.password.value.trim();
    if(email && password){
      loggedInUser = {email};
      userEmailDisplay.textContent = email;
      btnLogin.style.display = 'none';
      btnLogout.style.display = 'inline-block';
      toggleAuthModal(false);
      alert(`Logged in as ${email}`);
    }
  });

  btnLogout.addEventListener('click', () => {
    loggedInUser = null;
    userEmailDisplay.textContent = '';
    btnLogin.style.display = 'inline-block';
    btnLogout.style.display = 'none';
    alert('Logged out');
  });

  wishlistBtn.addEventListener('click', () => {
    if(loggedInUser){
      toggleWishlistModal(true);
    } else {
      alert('Please login to view your wishlist.');
    }
  });
  document.getElementById('wishlist-close-btn').addEventListener('click', () => toggleWishlistModal(false));

  cartBtn.addEventListener('click', () => {
    cartSidebar.style.right = '0';
  });
  document.getElementById('cart-close-btn').addEventListener('click', () => {
    cartSidebar.style.right = '-350px';
  });

  modalClose.addEventListener('click', closeProductModal);
  modalAddCart.addEventListener('click', () => {
    if(currentProduct){
      const variantSelect = document.getElementById('variant-select');
      const selectedVariant = variantSelect ? variantSelect.value : null;
      addToCart(currentProduct, selectedVariant);
      closeProductModal();
    }
  });
  modalAddWishlist.addEventListener('click', () => {
    if(currentProduct){
      addToWishlist(currentProduct);
    }
  });

  // Category filter buttons
  categoryButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      categoryButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      filteredCategory = btn.getAttribute('data-category');
      renderProducts();
    });
  });

  // Search function
  document.getElementById('search-btn').addEventListener('click', () => {
    const query = document.getElementById('search-input').value.trim().toLowerCase();
    if(query === ''){
      filteredCategory = 'all';
      categoryButtons.forEach(b => b.classList.remove('active'));
      categoryButtons[0].classList.add('active');
      renderProducts();
      return;
    }
    const filtered = products.filter(p => p.title.toLowerCase().includes(query) || p.description.toLowerCase().includes(query));
    if(filtered.length === 0){
      productGrid.innerHTML = '<p>No products match your search.</p>';
    } else {
      productGrid.innerHTML = '';
      filtered.forEach(product => {
        const productElem = document.createElement('article');
        productElem.className = 'product-card';
        productElem.tabIndex = 0;
        productElem.setAttribute('aria-label', `${product.title}, Price: ${formatPrice(product.price)}, Rating: ${product.rating}`);
        productElem.innerHTML = `
          <img src="${product.image}" alt="${product.title}" />
          <h3>${product.title}</h3>
          <div class="price">${formatPrice(product.price)}</div>
          <div class="rating">⭐ ${product.rating.toFixed(1)}</div>
          <button aria-label="View details for ${product.title}">View Details</button>
        `;
        productGrid.appendChild(productElem);

        productElem.querySelector('button').addEventListener('click', () => openProductModal(product));
        productElem.addEventListener('keydown', e => {
          if(e.key === 'Enter') openProductModal(product);
        });
      });
    }
  });

  // Initial render
  renderProducts();
  updateCartCount();
})();
</script>

</body>
</html>
